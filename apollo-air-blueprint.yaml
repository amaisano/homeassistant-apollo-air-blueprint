blueprint:
  name: Apollo Air Sensor Notification
  description: >
    This blueprint monitors values from Apollo Air sensors and sends a notification if any values exceed the defined thresholds.
  domain: automation
  input:
    notification_target:
      name: Notification Target
      description: "Select the notification target (e.g., mobile device)."
      selector:
        device:
          integration: mobile_app
          multiple: true

    temperature_settings:
      name: Temperature
      icon: mdi:thermometer
      collapsed: true
      input:
        temperature_sensor:
          name: Temperature Sensor
          description: "Select the temperature sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
              device_class: temperature
        min_temp:
          name: Minimum Temperature
          description: "Set the minimum acceptable temperature (°C)."
          default: 15
          selector:
            number:
              min: -10
              max: 50
              unit_of_measurement: °C
        max_temp:
          name: Maximum Temperature
          description: "Set the maximum acceptable temperature (°C)."
          default: 30
          selector:
            number:
              min: -10
              max: 50
              unit_of_measurement: °C

    humidity_settings:
      name: Humidity
      icon: mdi:water-percent
      collapsed: true
      input:
        humidity_sensor:
          name: Humidity Sensor
          description: "Select the humidity sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
              device_class: humidity
        min_humidity:
          name: Minimum Humidity
          description: "Set the minimum acceptable humidity (%)."
          default: 30
          selector:
            number:
              min: 0
              max: 100
              unit_of_measurement: "%"
        max_humidity:
          name: Maximum Humidity
          description: "Set the maximum acceptable humidity (%)."
          default: 60
          selector:
            number:
              min: 0
              max: 100
              unit_of_measurement: "%"

    pressure_settings:
      name: Pressure
      icon: mdi:gauge
      collapsed: true
      input:
        pressure_sensor:
          name: Pressure Sensor
          description: "Select the pressure sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
              device_class: pressure
        min_pressure:
          name: Minimum Pressure
          description: "Set the minimum acceptable pressure (hPa)."
          default: 980
          selector:
            number:
              min: 800
              max: 1200
              unit_of_measurement: hPa
        max_pressure:
          name: Maximum Pressure
          description: "Set the maximum acceptable pressure (hPa)."
          default: 1050
          selector:
            number:
              min: 800
              max: 1200
              unit_of_measurement: hPa

    pm1_settings:
      name: PM1
      icon: mdi:weather-fog
      collapsed: true
      input:
        pm1_sensor:
          name: PM1 Sensor
          description: "Select the PM1 sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_pm1:
          name: Maximum PM1
          description: "Set the maximum acceptable PM1 level (µg/m³)."
          default: 10
          selector:
            number:
              min: 0
              max: 500
              unit_of_measurement: µg/m³

    pm25_settings:
      name: PM2.5
      icon: mdi:weather-fog
      collapsed: true
      input:
        pm25_sensor:
          name: PM2.5 Sensor
          description: "Select the PM2.5 sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_pm25:
          name: Maximum PM2.5
          description: "Set the maximum acceptable PM2.5 level (µg/m³)."
          default: 25
          selector:
            number:
              min: 0
              max: 500
              unit_of_measurement: µg/m³

    pm4_settings:
      name: PM4
      icon: mdi:weather-fog
      collapsed: true
      input:
        pm4_sensor:
          name: PM4 Sensor
          description: "Select the PM4 sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_pm4:
          name: Maximum PM4
          description: "Set the maximum acceptable PM4 level (µg/m³)."
          default: 40
          selector:
            number:
              min: 0
              max: 500
              unit_of_measurement: µg/m³

    pm10_settings:
      name: PM10
      icon: mdi:weather-fog
      collapsed: true
      input:
        pm10_sensor:
          name: PM10 Sensor
          description: "Select the PM10 sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_pm10:
          name: Maximum PM10
          description: "Set the maximum acceptable PM10 level (µg/m³)."
          default: 50
          selector:
            number:
              min: 0
              max: 500
              unit_of_measurement: µg/m³

    voc_settings:
      name: VOC
      icon: mdi:chemical-weapon
      collapsed: true
      input:
        voc_sensor:
          name: VOC Sensor
          description: "Select the VOC sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_voc:
          name: Maximum VOC
          description: "Set the maximum acceptable VOC level (ppb)."
          default: 400
          selector:
            number:
              min: 0
              max: 1000
              unit_of_measurement: ppb

    nox_settings:
      name: NOx
      icon: mdi:weather-lightning
      collapsed: true
      input:
        nox_sensor:
          name: NOx Sensor
          description: "Select the NOx sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_nox:
          name: Maximum NOx
          description: "Set the maximum acceptable NOx level (ppb)."
          default: 30
          selector:
            number:
              min: 0
              max: 100
              unit_of_measurement: ppb

    co2_settings:
      name: CO2
      icon: mdi:molecule-co2
      collapsed: true
      input:
        co2_sensor:
          name: CO2 Sensor
          description: "Select the CO2 sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
              device_class: carbon_dioxide
        max_co2:
          name: Maximum CO2
          description: "Set the maximum acceptable CO2 level (ppm)."
          default: 1000
          selector:
            number:
              min: 0
              max: 5000
              unit_of_measurement: ppm

    co_settings:
      name: CO
      icon: mdi:molecule-co
      collapsed: true
      input:
        co_sensor:
          name: CO Sensor
          description: "Select the CO sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
              device_class: carbon_monoxide
        max_co:
          name: Maximum CO
          description: "Set the maximum acceptable CO level (ppm)."
          default: 10
          selector:
            number:
              min: 0
              max: 100
              unit_of_measurement: ppm

    ethanol_settings:
      name: Ethanol
      icon: mdi:glass-wine
      collapsed: true
      input:
        ethanol_sensor:
          name: Ethanol Sensor
          description: "Select the ethanol sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_ethanol:
          name: Maximum Ethanol
          description: "Set the maximum acceptable ethanol level (ppb)."
          default: 50
          selector:
            number:
              min: 0
              max: 500
              unit_of_measurement: ppb

    hydrogen_settings:
      name: Hydrogen
      icon: mdi:gas-cylinder
      collapsed: true
      input:
        hydrogen_sensor:
          name: Hydrogen Sensor
          description: "Select the hydrogen sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_hydrogen:
          name: Maximum Hydrogen
          description: "Set the maximum acceptable hydrogen level (ppm)."
          default: 1
          selector:
            number:
              min: 0
              max: 10
              unit_of_measurement: ppm

    no2_settings:
      name: NO2
      icon: mdi:gas-cylinder
      collapsed: true
      input:
        no2_sensor:
          name: NO2 Sensor
          description: "Select the NO2 sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_no2:
          name: Maximum NO2
          description: "Set the maximum acceptable NO2 level (ppb)."
          default: 20
          selector:
            number:
              min: 0
              max: 200
              unit_of_measurement: ppb

    ammonia_settings:
      name: Ammonia
      icon: mdi:chemical-weapon
      collapsed: true
      input:
        ammonia_sensor:
          name: Ammonia Sensor
          description: "Select the ammonia sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_ammonia:
          name: Maximum Ammonia
          description: "Set the maximum acceptable ammonia level (ppm)."
          default: 10
          selector:
            number:
              min: 0
              max: 50
              unit_of_measurement: ppm

    methane_settings:
      name: Methane
      icon: mdi:chemical-weapon
      collapsed: true
      input:
        methane_sensor:
          name: Methane Sensor
          description: "Select the methane sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_methane:
          name: Maximum Methane
          description: "Set the maximum acceptable methane level (ppm)."
          default: 10
          selector:
            number:
              min: 0
              max: 50
              unit_of_measurement: ppm

    bluetooth_settings:
      name: Bluetooth Devices
      icon: mdi:bluetooth
      collapsed: true
      input:
        bluetooth_sensor:
          name: Bluetooth Sensor
          description: "Select the Bluetooth sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_bluetooth:
          name: Maximum Bluetooth Devices
          description: "Set the maximum number of Bluetooth devices allowed in range."
          default: 5
          selector:
            number:
              min: 0
              max: 50

    aqi_settings:
      name: Air Quality Index
      icon: mdi:air-filter
      collapsed: true
      input:
        aqi_sensor:
          name: AQI Sensor
          description: "Select the AQI sensor."
          default: null
          selector:
            entity:
              integration: esphome
              domain: sensor
        max_aqi:
          name: Maximum AQI
          description: "Set the maximum acceptable Air Quality Index value."
          default: 100
          selector:
            number:
              min: 0
              max: 500

trigger:
  # Temperature triggers
  - platform: template
    value_template: >
      {{ not is_state('!input temperature_sensor', 'unavailable') and 
         not is_state('!input temperature_sensor', 'None') and 
         states('!input temperature_sensor') | float > !input max_temp }}
    id: "temperature_high"
  - platform: template
    value_template: >
      {{ not is_state('!input temperature_sensor', 'unavailable') and 
         not is_state('!input temperature_sensor', 'None') and 
         states('!input temperature_sensor') | float < !input min_temp }}
    id: "temperature_low"

  # Humidity triggers
  - platform: template
    value_template: >
      {{ not is_state('!input humidity_sensor', 'unavailable') and 
         not is_state('!input humidity_sensor', 'None') and 
         states('!input humidity_sensor') | float > !input max_humidity }}
    id: "humidity_high"
  - platform: template
    value_template: >
      {{ not is_state('!input humidity_sensor', 'unavailable') and 
         not is_state('!input humidity_sensor', 'None') and 
         states('!input humidity_sensor') | float < !input min_humidity }}
    id: "humidity_low"

  # Pressure triggers
  - platform: template
    value_template: >
      {{ not is_state('!input pressure_sensor', 'unavailable') and 
         not is_state('!input pressure_sensor', 'None') and 
         states('!input pressure_sensor') | float > !input max_pressure }}
    id: "pressure_high"
  - platform: template
    value_template: >
      {{ not is_state('!input pressure_sensor', 'unavailable') and 
         not is_state('!input pressure_sensor', 'None') and 
         states('!input pressure_sensor') | float < !input min_pressure }}
    id: "pressure_low"

  # PM1 triggers
  - platform: template
    value_template: >
      {{ not is_state('!input pm1_sensor', 'unavailable') and 
         not is_state('!input pm1_sensor', 'None') and 
         states('!input pm1_sensor') | float > !input max_pm1 }}
    id: "pm1_high"

  # PM2.5 triggers
  - platform: template
    value_template: >
      {{ not is_state('!input pm25_sensor', 'unavailable') and 
         not is_state('!input pm25_sensor', 'None') and 
         states('!input pm25_sensor') | float > !input max_pm25 }}
    id: "pm25_high"

  # PM4 triggers
  - platform: template
    value_template: >
      {{ not is_state('!input pm4_sensor', 'unavailable') and 
         not is_state('!input pm4_sensor', 'None') and 
         states('!input pm4_sensor') | float > !input max_pm4 }}
    id: "pm4_high"

  # PM10 triggers
  - platform: template
    value_template: >
      {{ not is_state('!input pm10_sensor', 'unavailable') and 
         not is_state('!input pm10_sensor', 'None') and 
         states('!input pm10_sensor') | float > !input max_pm10 }}
    id: "pm10_high"

  # VOC triggers
  - platform: template
    value_template: >
      {{ not is_state('!input voc_sensor', 'unavailable') and 
         not is_state('!input voc_sensor', 'None') and 
         states('!input voc_sensor') | float > !input max_voc }}
    id: "voc_high"

  # NOx triggers
  - platform: template
    value_template: >
      {{ not is_state('!input nox_sensor', 'unavailable') and 
         not is_state('!input nox_sensor', 'None') and 
         states('!input nox_sensor') | float > !input max_nox }}
    id: "nox_high"

  # CO2 triggers
  - platform: template
    value_template: >
      {{ not is_state('!input co2_sensor', 'unavailable') and 
         not is_state('!input co2_sensor', 'None') and 
         states('!input co2_sensor') | float > !input max_co2 }}
    id: "co2_high"

  # CO triggers
  - platform: template
    value_template: >
      {{ not is_state('!input co_sensor', 'unavailable') and 
         not is_state('!input co_sensor', 'None') and 
         states('!input co_sensor') | float > !input max_co }}
    id: "co_high"

  # Ethanol triggers
  - platform: template
    value_template: >
      {{ not is_state('!input ethanol_sensor', 'unavailable') and 
         not is_state('!input ethanol_sensor', 'None') and 
         states('!input ethanol_sensor') | float > !input max_ethanol }}
    id: "ethanol_high"

  # Hydrogen triggers
  - platform: template
    value_template: >
      {{ not is_state('!input hydrogen_sensor', 'unavailable') and 
         not is_state('!input hydrogen_sensor', 'None') and 
         states('!input hydrogen_sensor') | float > !input max_hydrogen }}
    id: "hydrogen_high"

  # NO2 triggers
  - platform: template
    value_template: >
      {{ not is_state('!input no2_sensor', 'unavailable') and 
         not is_state('!input no2_sensor', 'None') and 
         states('!input no2_sensor') | float > !input max_no2 }}
    id: "no2_high"

  # Ammonia triggers
  - platform: template
    value_template: >
      {{ not is_state('!input ammonia_sensor', 'unavailable') and 
         not is_state('!input ammonia_sensor', 'None') and 
         states('!input ammonia_sensor') | float > !input max_ammonia }}
    id: "ammonia_high"

  # Methane triggers
  - platform: template
    value_template: >
      {{ not is_state('!input methane_sensor', 'unavailable') and 
         not is_state('!input methane_sensor', 'None') and 
         states('!input methane_sensor') | float > !input max_methane }}
    id: "methane_high"

  # Bluetooth triggers
  - platform: template
    value_template: >
      {{ not is_state('!input bluetooth_sensor', 'unavailable') and 
         not is_state('!input bluetooth_sensor', 'None') and 
         states('!input bluetooth_sensor') | float > !input max_bluetooth }}
    id: "bluetooth_high"

  # AQI triggers
  - platform: template
    value_template: >
      {{ not is_state('!input aqi_sensor', 'unavailable') and 
         not is_state('!input aqi_sensor', 'None') and 
         states('!input aqi_sensor') | float > !input max_aqi }}
    id: "aqi_high"

action:
  - variables:
      temperature_sensor: !input temperature_sensor
      humidity_sensor: !input humidity_sensor
      pressure_sensor: !input pressure_sensor
      pm1_sensor: !input pm1_sensor
      pm25_sensor: !input pm25_sensor
      pm4_sensor: !input pm4_sensor
      pm10_sensor: !input pm10_sensor
      voc_sensor: !input voc_sensor
      nox_sensor: !input nox_sensor
      co2_sensor: !input co2_sensor
      co_sensor: !input co_sensor
      ethanol_sensor: !input ethanol_sensor
      hydrogen_sensor: !input hydrogen_sensor
      no2_sensor: !input no2_sensor
      ammonia_sensor: !input ammonia_sensor
      methane_sensor: !input methane_sensor
      bluetooth_sensor: !input bluetooth_sensor
      aqi_sensor: !input aqi_sensor

  - choose:
      # Ethanol actions
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.id == "ethanol_high" and
                 states(ethanol_sensor) not in ['unavailable', 'unknown', 'None'] }}
        sequence:
          - service: notify.notify
            data:
              title: "Ethanol Alert"
              message: >
                Ethanol levels are too high! Current value: {{ states(ethanol_sensor) }} ppb.
              data:
                notification_icon: mdi:glass-wine

      # Hydrogen actions
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.id == "hydrogen_high" and
                 states(hydrogen_sensor) not in ['unavailable', 'unknown', 'None'] }}
        sequence:
          - service: notify.notify
            data:
              title: "Hydrogen Alert"
              message: >
                Hydrogen levels are too high! Current value: {{ states(hydrogen_sensor) }} ppm.
              data:
                notification_icon: mdi:gas-cylinder

      # NO2 actions
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.id == "no2_high" and
                 states(no2_sensor) not in ['unavailable', 'unknown', 'None'] }}
        sequence:
          - service: notify.notify
            data:
              title: "NO2 Alert"
              message: >
                NO2 levels are too high! Current value: {{ states(no2_sensor) }} ppb.
              data:
                notification_icon: mdi:gas-cylinder

      # Ammonia actions
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.id == "ammonia_high" and
                 states(ammonia_sensor) not in ['unavailable', 'unknown', 'None'] }}
        sequence:
          - service: notify.notify
            data:
              title: "Ammonia Alert"
              message: >
                Ammonia levels are too high! Current value: {{ states(ammonia_sensor) }} ppm.
              data:
                notification_icon: mdi:chemical-weapon

      # Methane actions
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.id == "methane_high" and
                 states(methane_sensor) not in ['unavailable', 'unknown', 'None'] }}
        sequence:
          - service: notify.notify
            data:
              title: "Methane Alert"
              message: >
                Methane levels are too high! Current value: {{ states(methane_sensor) }} ppm.
              data:
                notification_icon: mdi:chemical-weapon

      # Bluetooth actions
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.id == "bluetooth_high" and
                 states(bluetooth_sensor) not in ['unavailable', 'unknown', 'None'] }}
        sequence:
          - service: notify.notify
            data:
              title: "Bluetooth Devices Alert"
              message: >
                Too many Bluetooth devices detected! Current count: {{ states(bluetooth_sensor) }}.
              data:
                notification_icon: mdi:bluetooth

      # AQI actions
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.id == "aqi_high" and
                 states(aqi_sensor) not in ['unavailable', 'unknown', 'None'] }}
        sequence:
          - service: notify.notify
            data:
              title: "Air Quality Index Alert"
              message: >
                Air Quality Index (AQI) is too high! Current value: {{ states(aqi_sensor) }}.
              data:
                notification_icon: mdi:air-filter
